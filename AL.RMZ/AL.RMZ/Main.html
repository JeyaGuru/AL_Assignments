<!DOCTYPE html>
<html>
<body>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" />
        <style>
            table {
                padding-top: 2%;
                padding-left: 5%;
                padding-right: 5%;
                padding-bottom: 5%;
                height: 100%;
                border-left: 120px solid #808080;
                border-right: 120px solid #808080;
            }

            td {
                width: 75px
            }

            th {
                height: 50px;
                width: 100px;
            }
        </style>
    </head>
    <h1>API: City, Facility, Building, Floor, Zone, ElectricityMeter & WaterMeter</h1>
    <hr />
    <br />
    <div class="row">
        <div class="col-lg-3"></div>
        <div class="col-lg-6">

            <div class="form-group">
                <label class="col-md-4 control-label">City Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlCity"></select><br />
                </div>
            </div>
            <br />
            <div class="form-group">
                <label class="col-md-4 control-label">Facility Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlFacility"></select>
                    <br />

                </div>
            </div>
            <br />

            <div class="form-group">
                <label class="col-md-4 control-label">Building Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlBuilding"></select><br />
                </div>
            </div>
            <br />
            <div class="form-group">
                <label class="col-md-4 control-label">Floor Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlFloor"></select>
                    <br />

                </div>
            </div>
            <br />
            <div class="form-group">
                <label class="col-md-4 control-label">Zone Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlZone"></select><br />
                </div>
            </div>
            <br />
            <div class="form-group">
                <label class="col-md-4 control-label">ElectricityMeter Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlElectricityMeter"></select>
                    <br />

                </div>
            </div>
            <br />
            <div class="form-group">
                <label class="col-md-4 control-label">WaterMeter Name</label>
                <div class="col-md-6">
                    <select class="form-control" id="ddlWaterMeter"></select>
                    <br />

                </div>
            </div>
            <br />

        </div>
        <div class="col-lg-3"></div>
    </div>
    <div class="container">
        <br />
        <div style="width:90%; margin:0 auto;">
            <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>ElectricityMeterId</th>
                        <th>ReadingDate</th>
                        <th>StartUnit</th>
                        <th>EndUnit</th>
                        <th>TotalUnit</th>
                    </tr>
                </thead>
            </table>
            <table id="example2" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                <thead id="meterTable">

                </thead>
            </table>
        </div>
    </div>
    <script>


    $(document).ready(function () {

   var ddlCity = $('#ddlCity');
        ddlCity.append($("<option></option>").val('').html('Please Select City'));
        $.ajax({
            url: 'https://localhost:44325/api/city',
            type: 'GET',
            dataType: 'json',
            success: function (d) {
                $.each(d, function (i, city) {
                    ddlCity.append($("<option></option>").val(city.id).html(city.name));
                });
            },
            error: function () {
                alert('Error!');
            }
        });

	$("#ddlCity").change(function () {
            var CityId = parseInt($(this).val());

            if (!isNaN(CityId)) {
                var ddlFacility = $('#ddlFacility');
                ddlFacility.empty();
                ddlFacility.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/Facility/'+CityId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { cityid: CityId },
                    success: function (d) {
                        ddlFacility.empty(); // Clear the please wait
                        ddlFacility.append($("<option></option>").val('').html('Select Facility'));
                        $.each(d, function (i, facility) {
                            ddlFacility.append($("<option></option>").val(facility.id).html(facility.name));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

	$("#ddlFacility").change(function () {
            var FacilityId = parseInt($(this).val());

            if (!isNaN(FacilityId)) {
                var ddlBuilding = $('#ddlBuilding');
                ddlBuilding.empty();
                ddlBuilding.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/Building/'+FacilityId,
                    type: 'GET',
                    dataType: 'json',
                   // data: { facilityid: FacilityId },
                    success: function (d) {
                        ddlBuilding.empty(); // Clear the please wait
                        ddlBuilding.append($("<option></option>").val('').html('Select Building'));
                        $.each(d, function (i, building) {
                            ddlBuilding.append($("<option></option>").val(building.id).html(building.name));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

			$("#ddlBuilding").change(function () {
            var BuildingId = parseInt($(this).val());

            if (!isNaN(BuildingId)) {
                var ddlFloor = $('#ddlFloor');
                ddlFloor.empty();
                ddlFloor.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/Floor/'+BuildingId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { buildingid: BuildingId },
                    success: function (d) {
                        ddlFloor.empty(); // Clear the please wait
                        ddlFloor.append($("<option></option>").val('').html('Select Floor'));
                        $.each(d, function (i, floor) {
                            ddlFloor.append($("<option></option>").val(floor.id).html(floor.name));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

			$("#ddlFloor").change(function () {
            var FloorId = parseInt($(this).val());

            if (!isNaN(FloorId)) {
                var ddlZone = $('#ddlZone');
                ddlZone.empty();
                ddlZone.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/Zone/'+FloorId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { floorid : FloorId },
                    success: function (d) {
                        ddlZone.empty(); // Clear the please wait
                        ddlZone.append($("<option></option>").val('').html('Select Zone'));
                        $.each(d, function (i, zone) {
                            ddlZone.append($("<option></option>").val(zone.id).html(zone.name));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

			$("#ddlZone").change(function () {
            var ZoneId = parseInt($(this).val());

            if (!isNaN(ZoneId)) {
                var ddlElectricityMeter = $('#ddlElectricityMeter');
                ddlElectricityMeter.empty();
                ddlElectricityMeter.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/ElectricityMeter/'+ZoneId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { zoneid : ZoneId },
                    success: function (d) {
                        ddlElectricityMeter.empty(); // Clear the please wait
                        ddlElectricityMeter.append($("<option></option>").val('').html('Select ElectricityMeter'));
                        $.each(d, function (i, electricitymeter) {
                            ddlElectricityMeter.append($("<option></option>").val(electricitymeter.id).html(electricitymeter.number));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

			$("#ddlZone").change(function () {
            var ZoneId = parseInt($(this).val());

            if (!isNaN(ZoneId)) {
                var ddlWaterMeter = $('#ddlWaterMeter');
                ddlWaterMeter.empty();
                ddlWaterMeter.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/WaterMeter/'+ZoneId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { zoneid : ZoneId },
                    success: function (d) {
                        ddlWaterMeter.empty(); // Clear the please wait
                        ddlWaterMeter.append($("<option></option>").val('').html('Select WaterMeter'));
                        $.each(d, function (i, Watermeter) {
                            ddlWaterMeter.append($("<option></option>").val(Watermeter.id).html(Watermeter.number));
                        });
                    },
                    error: function () {
                        alert('Error!');
                    }
                });
            } });

			$("#ddlElectricityMeter").change(function () {
            var ElectricityMeterId = parseInt($(this).val());

            if (!isNaN(ElectricityMeterId)) {
			 var ddlmetertable = $('#meterTable');
                ddlmetertable.empty();
               // ddlmetertable.append($("<option></option>").val('').html('Please wait ...'));

                $.ajax({
                    url: 'https://localhost:44325/api/ElectricityMeterDetail/'+ElectricityMeterId,
                    type: 'GET',
                    dataType: 'json',
                    //data: { zoneid : ZoneId },
                    success: function (d) {
                        ddlmetertable.empty(); // Clear the please wait
                        //ddlmetertable.append($("<option></option>").val('').html('Select WaterMeter'));

                        $.each(d, function (i, detail) {
						var row = $('<tr>');
						//alert(meterDetail.totalUnits);
								row.append($('<th>'+detail.id+'</th>'+'<th>'+detail.electricityMeterId+'</th>'+'<th>'+detail.readingDate+'</th>'+'<th>'+detail.startReading+'</th>'+'<th>'+detail.endReading+'</th>'+'<th>'+detail.totalUnits+'</th>'));
							row.append($('</tr>'));
						$('#meterTable').append(row);
                        });

                    },
                    error: function () {
                        alert('Error!');
                    }
                });

        }
    });
    });
    </script>


</body>

</html> 